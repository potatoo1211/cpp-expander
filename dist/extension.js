(()=>{"use strict";var e={265(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),i=0;i<n.length;i++)"default"!==n[i]&&o(t,e,n[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){d=a.window.createOutputChannel("C++ Expander Log");let t=a.commands.registerCommand("cpp-expander.justRun",async()=>{await l({copyAfterRun:!1})}),n=a.commands.registerCommand("cpp-expander.runAndCopy",async()=>{await l({copyAfterRun:!0})});e.subscriptions.push(t),e.subscriptions.push(n),e.subscriptions.push(d)},t.deactivate=function(){d&&d.dispose()};const a=i(n(398)),c=i(n(896)),u=i(n(928));let p,d;async function l(e){const t=a.window.activeTextEditor;if(!t)return;t.document.isDirty&&await t.document.save();const n=t.document.fileName;if(d.clear(),d.appendLine(`[Start] Processing: ${n}`),p){try{p.terminate()}catch(e){}p=void 0}const r=`ulimit -s unlimited && g++ -std=c++20 -O2 -I. "${n}" && ./a.out; RET=$?; echo ""; echo "Press Enter to close..."; read dummy; exit $RET`,o=new a.Task({type:"cpp-expander",task:"run"},a.TaskScope.Workspace,"Run C++","cpp-expander",new a.ShellExecution(r));o.presentationOptions={reveal:a.TaskRevealKind.Always,focus:!0,panel:a.TaskPanelKind.Shared,clear:!0,showReuseMessage:!1};const s=a.tasks.onDidEndTaskProcess(async t=>{if(t.execution===p)if(s.dispose(),p=void 0,0===t.exitCode&&e.copyAfterRun)try{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath,t=function(e,t){const n=new Set;return function e(r,o){if(!o){if(n.has(r))return"";n.add(r)}if(!c.existsSync(r))throw new Error(`File not found: ${r}`);const s=c.readFileSync(r,"utf-8"),i=u.dirname(r);return s.replace(/^\s*#include\s*"([^"]+)".*$/gm,(n,r)=>{let o=u.resolve(i,r),s=c.existsSync(o);if(!s&&t){const e=u.resolve(t,r);c.existsSync(e)&&(o=e,s=!0)}if(s){d.appendLine(`  Expand: "${r}" -> ${o}`);const t=e(o,!1);return`// ${n.replace(/[\r\n]+/g,"")}\n${t}`}return d.appendLine(`  [Skip] Not found: "${r}"`),n})}(e,!0)}(n,e);await a.env.clipboard.writeText(t),a.window.showInformationMessage("Finished & Copied!"),d.appendLine("[Success] Copied to clipboard.")}catch(e){a.window.showErrorMessage(`Expand Error: ${e.message}`),d.appendLine(`[Error] ${e.message}`)}else 0!==t.exitCode&&d.appendLine(`[Info] Exit code ${t.exitCode}. Copy skipped.`)});p=await a.tasks.executeTask(o)}},398(e){e.exports=require("vscode")},896(e){e.exports=require("fs")},928(e){e.exports=require("path")}},t={},n=function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}(265);module.exports=n})();